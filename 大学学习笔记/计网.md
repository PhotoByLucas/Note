# Chapter 3
## 1. 传输层
  + 为不同主机(网络层提供)上的不同进程提供服务：报文段
  + 网络层的IP是不可靠服务
## 2. 多路复用/分解
  + 自身IP/端口号 目的IP/端口号
## 3. UDP
   1. 优点 
      1. 由应用层控制数据发送的时间和内容会更为精细。 
          + TCP的可靠传输和拥塞控制机制可能过分的延迟报文段的交付。实时应用不能过分延迟交付且可以容忍一定的数据丢失。
          + 应用层可以控制报文的发送，实现UDP的可靠传输。
      2. 无需建立连接：没有建立连接的时延。
      3. 无连接状态：无需维护接受发送缓存、拥塞控制参数、序号、确认号等。
      4. 分组首部开销小：TCP报文段首部至少20个字节，UDP报文段首部只有8个字节。
    2. UDP报文段
        + 源端口号、目的端口号、长度(首部+数据）、检验和、应用层报文。
        + UDP提供校验和的原因：1、无法保证所有链路都提供差错检测；2、存储在内存如路由器内存中时引入比特差错。这样符合端到端原则（end-end principle）。
## 4. 可靠传输连接        
  1. 解决比特差错 自动重传请求协议（Automatic Repeat reQuest, ARQ）
      + **差错检测** 通过校验字段等额外的比特实现。
      + **接收方反馈**  肯定/否定确认 
      + **重传** 接受方收到有错分组，发送方重传。
  2. 解决丢包
      + 发送方发送分组后通过**倒计数定时器**，等待一个时间值，如果这段时间内没有接收ACK，判断可能丢包，重传分组。
      + 分组经历较大时延，可能引发重传，产生冗余数据分组，但是这个可以通过之前的序号处理。
  3. 解决性能
  改用 **流水线 (pipelining)** 方式，允许发送方发送多个分组而无需等待确认，这要求： 
  + 增加**序号**范围。有许多未确认报文。
  + 发送方和接收方必须**缓存**多个分组。
  + 流水线的差错恢复。通过**回退N步 (Go-Back-N,GBN)** 和**选择重传（Selective Repeat， SR）**，处理丢失、损坏、时延大的分组。
    + GBN:允许发送方发送多个分组无需等待确认，但是**未确认的分组数不能大于N。N称为窗口长度**，GBN协议也称为滑动窗口协议（sliding-window protocol），**丢失后会重传丢失的包之后的所有包**。
    + SR: SR协议让发送方**仅重传怀疑在接收方出错（丢失或受损）的分组**，避免不必要的重传。需要接收方逐个确认正确接受的分组。 
 ## 5. TCP
  1. TCP特性
      + TCP是**面向连接**的可靠的运输协议。
      + TCP运行在端系统中，连接状态完全保留在端系统中。
      + TCP连接提供**全双工服务**（full-duplex service）：数据可以从进程A流向进程B的同时，从B流向A。
      + TCP连接是**点对点**（point-to-point）的，多播对TCP不可能。
      + TCP通过**三次握手建立连接**。客户进程通过套接字将数据传送到发送缓存（send buffer），TCP在在他方便的时候从缓存中取出数据并放入报文段。
        数据长度受限于**最大报文长度**（Maximum Segment Size, MSS），MSS由链路层的最大传输单元（Maximum Transmission）设置，要保证一个TCP报文段+TCP/IP首部（通常40个字节）适合单个链路层帧。典型数值：MTU-1500字节，MSS-1460字节。
  2. TCP报文段
      + 源端口号、目的端口号。
      + 序号、确认号：和可靠传输相关。 
        + 序号：报文段首字节的字节流编号。
        + 确认号：主机A**期望**从主机B收到的下一个字节的编号。
      + TCP提供累计确认（cumulative acknowledgment），只确认流中至第一个丢失字节为止的字节。
      + TCP接收方保留失序字节，并等待缺少的字节填补空隙。
      + 首部长度：由于选项字段，TCP首部长度可变。
      + 选项字段：协商MSS,定义时间戳（计算RTT）等。
      + 接受窗口：用于流量控制，接收方愿意接受的字节数量。
      + 6比特的标志字段、紧急数据指针：ACK表示确认号是否有效，RST、SYN、FIN用于连接的建立和拆除，PSH、URG和紧急数据指针实践中并未使用
  3. TCP连接管理
      + 三次握手
        1. C向S发送连接请求，SYN=1的报文，客户端选择初始序号client_isn。报文称为TCP SYN报文。
        2. S连接允许，SYN=1,初始序号server_isn。，分配服务器TCP的缓存和变量。报文称为SYNACK报文。
        3. 收到SYNACK后，客户端分配TCP缓存和变量。发送确认报文，可携带数据。 
## 6. 拥塞控制
        
